I have already implemented this in C, this is a C++ implementation, the logic more or less remains the same